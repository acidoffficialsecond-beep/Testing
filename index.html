<body>
  <div class="box">
    <h1>Auataun Proxy</h1>
    <p>Fetch Roblox games & game passes</p>

    <!-- USER ID INPUT -->
    <div class="input">
      <input id="userId" placeholder="Enter User ID" />
      <button onclick="fetchGames()">Get Games</button>
    </div>

    <div class="loading" id="loading">Loading…</div>

    <!-- GAMES LIST -->
    <div class="results" id="games"></div>

    <!-- GAME PASSES -->
    <div class="results" id="passes"></div>

    <code>/api/games?userId=USER_ID</code>
    <code>/api/gamepasses?gameId=UNIVERSE_ID</code>
  </div>

<script>
  const loading = document.getElementById("loading");
  const passesEl = document.getElementById("passes");

  async function fetchByGameId() {
    const gameId = document.getElementById("gameId").value.trim();
    if (!gameId) return;

    passesEl.innerHTML = "";
    loading.style.display = "block";

    try {
      // 1️⃣ Call /api/games to get Universe ID
      const gamesRes = await fetch(`/api/games?userId=${gameId}`);
      const gamesData = await gamesRes.json();

      if (!gamesData.games || !gamesData.games.length) {
        throw new Error("No games found");
      }

      const universeId = gamesData.games[0].id;

      // 2️⃣ Fetch game passes using universeId
      const passesRes = await fetch(`/api/gamepasses?gameId=${universeId}`);
      const passesData = await passesRes.json();

      loading.style.display = "none";

      if (!passesData.gamePasses || !passesData.gamePasses.length) {
        passesEl.innerHTML =
          "<p style='color:#94a3b8;font-size:13px'>No game passes.</p>";
        return;
      }

      passesData.gamePasses.forEach(pass => {
        const el = document.createElement("div");
        el.className = "pass";
        el.innerHTML = `
          <strong>${pass.name}</strong>
          <span>Price: ${pass.price ?? "Offsale"}</span>
          <span>ID: ${pass.id}</span>
        `;
        passesEl.appendChild(el);
      });

    } catch (err) {
      loading.style.display = "none";
      passesEl.innerHTML =
        "<p style='color:#f87171;font-size:13px'>Failed to fetch game passes.</p>";
    }
  }
</script>
</body>
